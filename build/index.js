(()=>{"use strict";var e={338:(e,t,r)=>{var s=r(795);t.H=s.createRoot,s.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s=r(338);const o=window.wp.element,n=window.wp.data,i="SET_COURSE_ID",a="SET_PROGRESS",l="SET_CURRENT_UNIT",c="SET_IS_LOADING",d="SET_ERROR",u="SET_COURSE_INFO",m="NEXT_UNIT",g="PREV_UNIT",h="SET_USER_INFO",p="SET_COURSE_REVIEW",x="SET_REVIEW_LOADING",y="SET_REVIEW_ERROR",v="SET_REVIEW_MODAL_OPEN",f="SET_COURSE_COMPLETED",w={setCourseId:e=>({type:i,courseId:e}),setProgress:e=>({type:a,progress:e}),setCurrentUnit:e=>({type:l,unitId:e}),setIsLoading:e=>({type:c,isLoading:e}),setError:e=>({type:d,error:e}),setCourseInfo:e=>({type:u,courseInfo:e}),setUserInfo:e=>({type:h,userInfo:e}),*fetchCourseData(e){try{yield w.setIsLoading(!0);const t=yield{type:"FETCH_COURSE_DATA",courseId:e},r=t.courseitems.find((e=>e.key==t.current_unit_key));yield w.setCourseInfo(t),yield w.setCourseId(e),yield w.setCurrentUnit(r.id),yield w.setIsLoading(!1)}catch(e){yield w.setError(e instanceof Error?e.message:String(e)),yield w.setIsLoading(!1)}},*fetchUserInfo(){try{const e=yield{type:"FETCH_USER_INFO"};yield w.setUserInfo(e)}catch(e){yield w.handleError(e)}},*markUnitComplete(e,t,r){try{yield{type:"MARK_UNIT_COMPLETE",courseId:e,unitId:t,progress:r},yield w.fetchCourseData(e)}catch(e){yield w.handleError(e)}},*updateCourseProgress(e){try{const t=yield{type:"GET_COURSE_PROGRESS",courseId:e};yield w.setProgress(t)}catch(e){yield w.handleError(e)}},*handleError(e){const t=e instanceof Error?e.message:String(e);yield w.setError(t),yield w.setIsLoading(!1)},nextUnit:()=>({type:m}),prevUnit:()=>({type:g}),setCourseReview:e=>({type:p,review:e}),setReviewLoading:e=>({type:x,loading:e}),setReviewError:e=>({type:y,error:e}),setReviewModalOpen:e=>({type:v,open:e}),*fetchCourseReview(e){try{yield w.setReviewLoading(!0);const t=yield{type:"FETCH_COURSE_REVIEW",courseId:e};yield w.setCourseReview(t),yield w.setReviewLoading(!1)}catch(e){yield w.handleError(e),yield w.setReviewLoading(!1)}},*submitCourseReview({rating:e,review:t,courseId:r}){try{yield w.setIsLoading(!0);const s=yield{type:"SUBMIT_COURSE_REVIEW",rating:e,review:t,comment_post_ID:r};yield w.setCourseReview(s),yield w.setIsLoading(!1)}catch(e){yield w.handleError(e)}},setCourseCompleted:e=>({type:f,completed:e}),*finishCourse(e){try{yield w.setIsLoading(!0),yield{type:"FINISH_COURSE",courseId:e},yield w.setCourseCompleted(!0),yield w.fetchCourseData(e),yield w.setIsLoading(!1)}catch(e){yield w.handleError(e)}}},j={courseId:null,courseInfo:null,progress:0,currentUnitId:null,allUnits:null,isLoading:!1,error:null,token:null,userInfo:null,review:null,reviewLoading:!0,reviewError:null,reviewModalOpen:!1,courseTotalDuration:null,completedDuration:null,isCompleted:!1},I={getCourseId:e=>e.courseId,getCourseInfo:e=>e.courseInfo,getProgress(e){var t;return null!==(t=e.progress)&&void 0!==t?t:0},getCurrentUnitId:e=>e.currentUnitId,isLoading(e){var t;return null!==(t=e.isLoading)&&void 0!==t&&t},getError:e=>e.error,getUserInfo:e=>e.userInfo,getAllUnits:e=>e.allUnits,getCompletedUnits(e){var t;return null!==(t=e.allUnits?.filter((e=>1===e.status)))&&void 0!==t?t:[]},getCourseReview:e=>e.review,getReviewLoading:e=>e.reviewLoading,getReviewError:e=>e.reviewError,getReviewModalOpen:e=>e.reviewModalOpen,getCourseTotalDuration:e=>e.courseTotalDuration,getCompletedDuration:e=>e.completedDuration,isLoadingCourseData:(e,t)=>(0,n.select)("core/data").isResolving("custom-course-player","getCourseData",[t]),isLoadingUserInfo:e=>(0,n.select)("core/data").isResolving("custom-course-player","getUserInfo",[]),isCourseCompleted(e){var t;return null!==(t=e.isCompleted)&&void 0!==t&&t}},C=window.wp.apiFetch;var b=r.n(C);const N=window.wplmsCustomCoursePlayer.token,E={FETCH_COURSE_DATA:async e=>await(async({courseId:e,token:t})=>{try{const r=await b()({path:`/wplms/v2/user/coursestatus/${e}`,method:"POST",data:{token:t}});if(console.log(r),r)return r;throw new Error(r||"Failed to fetch course data")}catch(e){throw new Error("Error fetching course data")}})({courseId:e.courseId,token:N}),async FETCH_USER_INFO(){try{return await(async e=>{try{return await b()({path:"/wplms/v2/user/",method:"POST",data:{token:e}})}catch(e){console.error("Failed to fetch user info")}})(N)}catch(e){console.error("Error fetching user info:",e)}},async MARK_UNIT_COMPLETE(e){try{return await(async({courseId:e,unitId:t,token:r,progress:s})=>{try{return await b()({method:"POST",path:`/wplms/v2/user/coursestatus/${e}/item/${t}/markcomplete`,data:{token:r,course_id:e,item_id:t,progress:s}})}catch(e){console.error("Failed to mark unit complete")}})({courseId:e.courseId,unitId:e.unitId,token:N,progress:e.progress})}catch(e){console.error("Error marking unit complete:",e)}},async GET_COURSE_PROGRESS(e){try{return await(async({courseId:e,token:t})=>{try{return await b()({method:"POST",path:"wplms-custom-course-player/v1/course-progress",data:{course_id:e,token:t}})}catch(e){console.error("Failed to get course progress")}})({courseId:e.courseId,token:N})}catch(e){console.error("Error fetching course progress:",e)}},SUBMIT_COURSE_REVIEW:async e=>await(async({rating:e,review:t,token:r,comment_post_ID:s})=>{try{return await b()({path:"/wplms/v2/updatecourse/addreview",method:"POST",data:{token:r,comment_post_ID:s,rating:e,review:t,title:"Course Review",course_id:s}})}catch(e){console.error("Failed to submit review")}})({rating:e.rating,review:e.review,token:N,comment_post_ID:e.courseId}),FETCH_COURSE_REVIEW:async e=>await(async({courseId:e,token:t})=>{try{return await b()({path:`/wplms/v2/user/getreview/${e}`,method:"POST",data:{token:t,course_id:e}})}catch(e){throw console.error("Failed to fetch review status"),e}})({courseId:e.courseId,token:N}),async FINISH_COURSE(e){try{return await(async({courseId:e,token:t})=>{try{return await b()({method:"POST",path:"/wplms/v2/user/finishcourse",data:{course_id:e,token:t}})}catch(e){console.error("Failed to finish course")}})({courseId:e.courseId,token:N})}catch(e){throw console.error("Error finishing course:",e),e}}},k={*getCourseData(e){yield w.fetchCourseData(e)},*getUserInfo(){yield w.fetchUserInfo()}},S=(0,n.createReduxStore)("custom-course-player",{reducer:(e=j,t)=>{var r;switch(t.type){case i:return{...e,courseId:t.courseId};case u:const n=t.courseInfo.courseitems.filter((e=>"section"!==e.type)),w=n.reduce(((e,t)=>e+(t.duration||0)),0),j=n.filter((e=>1===e.status)).reduce(((e,t)=>e+(t.duration||0)),0),I=Math.round(j/w*100),C=parseInt(null!==(r=t.courseInfo.progress)&&void 0!==r?r:"0")>=100&&I>=100;return{...e,courseInfo:t.courseInfo,allUnits:n,courseTotalDuration:w,progress:I,completedDuration:j,isCompleted:C};case h:return{...e,userInfo:t.userInfo};case a:return{...e,progress:t.progress};case l:return{...e,currentUnitId:t.unitId};case c:return{...e,isLoading:t.isLoading};case d:return{...e,error:t.error};case m:{var s;const t=null!==(s=e?.allUnits?.findIndex((t=>t.id===e.currentUnitId)))&&void 0!==s?s:-1,r=e?.allUnits?.[t+1];return{...e,currentUnitId:r?r.id:e.currentUnitId}}case g:{var o;const t=null!==(o=e?.allUnits?.findIndex((t=>t.id===e.currentUnitId)))&&void 0!==o?o:-1,r=e?.allUnits?.[t-1];return{...e,currentUnitId:r?r.id:e.currentUnitId}}case p:return{...e,review:t.review};case x:return{...e,reviewLoading:t.loading};case y:return{...e,reviewError:t.error};case v:return{...e,reviewModalOpen:t.open};case f:return{...e,isCompleted:t.completed};default:return e}},actions:w,selectors:I,controls:E,resolvers:k});(0,n.register)(S);const R=window.React,U=window.wplmsCustomCoursePlayer.token,L=window.ReactJSXRuntime,_=({currentUnitId:e,courseId:t,isSidebarOpen:r,onToggleSidebar:s,onPrevious:o,onNext:n})=>{const{unitContent:i,loading:a,error:l}=((e,t)=>{const[r,s]=(0,R.useState)(null),[o,n]=(0,R.useState)(!0),[i,a]=(0,R.useState)(null);return(0,R.useEffect)((()=>{U&&(async()=>{if(!t)return s(null),void n(!1);try{n(!0);const r=await(async({courseId:e,unitId:t,token:r})=>{try{const s=await b()({path:`/wplms/v2/user/coursestatus/${e}/item/${t}`,method:"POST",data:{token:r}});if(s)return s;throw new Error("Failed to fetch unit content")}catch(e){console.error("Error fetching unit content:",e)}})({courseId:e,unitId:t,token:U});s(null!=r?r:null),a(null)}catch(e){a("Failed to fetch unit content"),s(null)}finally{n(!1)}})()}),[e,t,U]),{unitContent:r,loading:o,error:i}})(t,e),[c,d]=(0,R.useState)(!1);return(0,L.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto transition-all duration-300 relative "+(r?"mr-80":""),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[(0,L.jsx)("div",{className:"mb-6",children:a?(0,L.jsx)("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-2/3"}):(0,L.jsx)("h1",{className:"text-3xl font-bold mb-1",children:i?.title})}),a?(0,L.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:[(0,L.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"}),(0,L.jsx)("p",{className:"text-gray-600",children:"Loading content..."})]}):l?(0,L.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:(0,L.jsxs)("div",{className:"bg-red-50 p-6 rounded-lg text-center",children:[(0,L.jsx)("p",{className:"text-red-600 mb-4",children:l}),(0,L.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"})]})}):i?(0,L.jsxs)("div",{className:"custom_course_content max-h-[600px] relative",children:[(0,L.jsx)("div",{className:"transition-opacity duration-300 "+(a?"opacity-50":"opacity-100"),dangerouslySetInnerHTML:{__html:i.content}}),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("button",{className:"fixed top-1/2 left-4 bg-gray-800 text-white p-2 rounded-full transform -translate-y-1/2 transition-opacity duration-300 "+(c?"opacity-50 hover:opacity-100":"opacity-0"),onClick:o,disabled:a,children:(0,L.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,L.jsx)("button",{className:`fixed top-1/2 right-4 bg-gray-800 text-white p-2 rounded-full transform -translate-y-1/2 transition-opacity duration-300 ${r?"mr-[23rem]":""} ${c?"opacity-50 hover:opacity-100":"opacity-0"}`,onClick:n,disabled:a,children:(0,L.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]}):(0,L.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,L.jsx)("p",{className:"text-gray-600",children:"No content available"})})]})},O=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,T=({unit:e,currentUnitId:t})=>{var r;const{markUnitComplete:s,setCurrentUnit:i}=(0,n.useDispatch)("custom-course-player"),[a,l]=(0,R.useState)(null!==(r=e?.status)&&void 0!==r?r:0),{courseId:c,courseInfo:d}=(0,n.useSelect)((e=>({courseId:e("custom-course-player").getCourseId(),courseInfo:e("custom-course-player").getCourseInfo()})),[]),{completedDuration:u,courseTotalDuration:m}=(0,n.useSelect)((e=>({completedDuration:e("custom-course-player").getCompletedDuration(),courseTotalDuration:e("custom-course-player").getCourseTotalDuration()})),[]),g=(0,o.useCallback)((()=>e.duration&&m&&null!==u?Math.round((u+e.duration)/m*100):0),[u,e.duration,m]);return(0,L.jsxs)("div",{className:`flex items-center p-4 cursor-pointer transition-colors\n                               ${t===e.id?"bg-blue-50":"hover:bg-gray-50"}\n                               ${1===e.status?"opacity-75":""}`,onClick:()=>{return t=e.id,void i(t);var t},children:[(0,L.jsx)("div",{className:"flex-shrink-0 mr-3",children:1===a?(0,L.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,L.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):(0,L.jsx)("div",{className:"w-5 h-5 border-2 border-gray-300 rounded-full cursor-pointer",onClick:t=>{t.stopPropagation(),(async e=>{try{await s(c,e,g()),l(1)}catch(e){console.log(e)}})(e.id)}})}),(0,L.jsxs)("div",{className:"flex-grow",children:[(0,L.jsx)("h4",{className:"text-sm "+(t===e.id?"font-medium":""),children:e.title}),(0,L.jsxs)("div",{className:"flex items-center text-xs text-gray-500 mt-1",children:[e.icon&&(0,L.jsx)("span",{className:`${e.icon} mr-1`}),(0,L.jsx)("span",{children:O(e.duration)})]})]})]})},D=[15,75,100],M=({items:e,currentUnitId:t})=>{const[r,s]=(0,o.useState)(0),{sections:i,expandedSections:a,toggleSection:l,getSectionStats:c}=((e,t)=>{const[r,s]=(0,R.useState)([]),{sections:o,initialExpandedSection:n}=(0,R.useMemo)((()=>{const r=[];let s=null,o=-1;return e.forEach((e=>{"section"===e.type?(s&&r.push(s),s={id:e.id,key:e.key,title:e.title,units:[]}):"unit"===e.type&&s&&(s.units.push(e),e.id===t&&(o=r.length))})),s&&(r.push(s),-1===o&&s.units.some((e=>e.id===t))&&(o=r.length-1)),{sections:r,initialExpandedSection:o}}),[e,t]);(0,R.useEffect)((()=>{-1!==n&&s((e=>e.includes(n)?e:[...e,n]))}),[n]),(0,R.useEffect)((()=>{if(t){const e=o.findIndex((e=>e.units.some((e=>e.id===t))));-1===e||r.includes(e)||s((t=>[...t,e]))}}),[t,o]);const i=(0,R.useCallback)((e=>{s((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))}),[]),a=(0,R.useCallback)((e=>r.includes(e)),[r]),l=(0,R.useCallback)((e=>{const t=e.units.length,r=e.units.filter((e=>1===e.status)).length;return{totalUnits:t,completedUnits:r,totalDuration:e.units.reduce(((e,t)=>e+t.duration),0),isComplete:t===r&&t>0}}),[]);return{sections:o,expandedSections:r,toggleSection:i,isSectionExpanded:a,getSectionStats:l}})(e,t),{progress:d,courseId:u,isCompleted:m,hasReview:g,reviewLoading:h}=(0,n.useSelect)((e=>({progress:e("custom-course-player").getProgress(),courseId:e("custom-course-player").getCourseId(),isCompleted:e("custom-course-player").isCourseCompleted(),hasReview:void 0!==e("custom-course-player").getCourseReview()?.comment_ID,reviewLoading:e("custom-course-player").getReviewLoading()})),[]),{setReviewModalOpen:p,finishCourse:x}=(0,n.useDispatch)("custom-course-player");return(0,o.useEffect)((()=>{console.log({hasReview:g,reviewLoading:h}),g||h||(console.log("review modal open"),(()=>{if(g||h)return;const e=D.find((e=>d>=e&&r<e));e&&(p(!0),s(e))})())}),[d,g,h]),(0,L.jsxs)("div",{className:"space-y-2",children:[!m&&(0,L.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg",children:[(0,L.jsxs)("p",{className:"text-sm text-green-800 mb-2",children:["You've completed ",d,"% of the course! Ready to finish?"]}),(0,L.jsx)("button",{onClick:async()=>{u&&await x(u)},className:"w-full py-2 px-4 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Complete Course"})]}),m&&(0,L.jsx)("div",{className:"p-4 bg-green-100 rounded-lg",children:(0,L.jsx)("p",{className:"text-sm text-green-800",children:"ðŸŽ‰ Congratulations! You've completed this course."})}),i.map(((e,r)=>{const s=c(e),o=a.includes(r);return(0,L.jsxs)("div",{className:"border rounded-lg transition-colors border-gray-200",children:[(0,L.jsxs)("button",{className:`w-full flex items-center justify-between p-4 text-left\n                         transition-colors rounded-t-lg\n                         ${o?"bg-gray-50":"hover:bg-gray-50"}\n                         ${s.isComplete?"bg-green-50 hover:bg-green-100":""}`,onClick:()=>l(r),children:[(0,L.jsxs)("div",{className:"flex-grow",children:[(0,L.jsx)("div",{className:"flex items-center gap-2",children:(0,L.jsx)("h3",{className:"font-semibold text-gray-900 text-[1rem] ",children:e.title})}),(0,L.jsxs)("p",{className:"text-sm text-gray-500",children:[s.completedUnits,"/",s.totalUnits," lessons â€¢ ",O(s.totalDuration)]})]}),(0,L.jsx)("svg",{className:"w-5 h-5 text-gray-500 transition-transform "+(o?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&(0,L.jsx)("div",{className:"border-t border-gray-200",children:e.units.map((e=>(0,L.jsx)(T,{unit:e,currentUnitId:t},e.id)))})]},e.key)}))]})},P=({title:e,onToggle:t})=>(0,L.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,L.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:e}),(0,L.jsx)("button",{className:"text-gray-500 hover:text-gray-700",onClick:t,children:(0,L.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),F=({totalLectures:e,totalDuration:t,completedLectures:r})=>(0,L.jsxs)("div",{className:"mb-4",children:[(0,L.jsxs)("div",{className:"text-sm text-gray-600",children:[e," lectures â€¢ ",t," total length"]}),(0,L.jsx)("div",{className:"mt-2 h-1 bg-gray-200 rounded-full",children:(0,L.jsx)("div",{className:"h-full bg-blue-500 rounded-full",style:{width:r/e*100+"%"}})})]}),$=e=>{const t=e.reduce(((e,t)=>e+(t.duration||0)),0);return`${Math.floor(t/3600)}hr ${Math.floor(t%3600/60)}min`},W=({isOpen:e,onToggle:t})=>{const{courseInfo:r,currentUnitId:s}=(0,n.useSelect)((e=>({courseInfo:e("custom-course-player").getCourseInfo(),currentUnitId:e("custom-course-player")?.getCurrentUnitId()})),[]);return r?(0,L.jsx)("div",{className:`fixed top-0 right-0 w-[24rem] bg-white border-l border-gray-200 h-full transform \n        ${e?"translate-x-0":"translate-x-full"} transition-transform duration-300 ease-in-out z-10`,children:(0,L.jsx)("div",{className:"h-full overflow-y-auto pt-16",children:(0,L.jsxs)("div",{className:"p-4",children:[(0,L.jsx)(P,{title:"Course content",onToggle:t}),(0,L.jsx)(F,{totalLectures:(o=r.courseitems,o.filter((e=>"section"!==e.type)).length),totalDuration:$(r.courseitems),completedLectures:r.courseitems.filter((e=>1===e.status)).length}),(0,L.jsx)(M,{items:r.courseitems,currentUnitId:s})]})})}):null;var o},B=({filled:e})=>(0,L.jsx)("svg",{className:"w-8 h-8 "+(e?"text-yellow-400":"text-gray-300"),fill:e?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"1.5",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),A=({rating:e,onRatingChange:t})=>(0,L.jsx)("div",{className:"flex items-center gap-1 mb-6",children:[1,2,3,4,5].map((r=>(0,L.jsx)("button",{onClick:()=>t(r),className:"bg-transparent transition-transform hover:scale-110","aria-label":`Rate ${r} stars`,children:(0,L.jsx)(B,{filled:r<=e})},r)))}),z=({rating:e,review:t,error:r,isLoading:s,onRatingChange:o,onReviewChange:n,onSubmit:i})=>(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A,{rating:e,onRatingChange:o}),(0,L.jsx)("textarea",{value:t,onChange:e=>n(e.target.value),placeholder:"Share your thoughts about this course...",className:"w-full h-32 p-3 border rounded-md mb-4 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none",maxLength:500,disabled:s}),r&&(0,L.jsx)("div",{className:"mb-4 text-red-600 p-3 bg-red-50 rounded-md",children:r}),(0,L.jsxs)("div",{className:"flex justify-between items-center",children:[(0,L.jsxs)("span",{className:"text-sm text-gray-500",children:[500-t.length," characters remaining"]}),(0,L.jsx)("button",{onClick:i,className:"px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700  font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:t.length<10||s,children:s?"Submitting...":"Submit Review"})]})]}),H=()=>(0,L.jsxs)("div",{className:"text-center py-8",children:[(0,L.jsx)("div",{className:"mb-4 text-green-500",children:(0,L.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,L.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Thank you for your review!"}),(0,L.jsx)("p",{className:"text-gray-600",children:"Your feedback helps improve the course for future students."})]});function V({isOpen:e,courseId:t,onClose:r,progress:s,courseName:o="Course",onReviewSuccess:i}){const[a,l]=(0,R.useState)(5),[c,d]=(0,R.useState)(""),[u,m]=(0,R.useState)(""),[g,h]=(0,R.useState)(!1),p=(0,n.useDispatch)(),{userInfo:x,currentReview:y,isLoading:v}=(0,n.useSelect)((e=>({userInfo:e("custom-course-player").getUserInfo(),currentReview:e("custom-course-player").getCourseReview(),isLoading:e("custom-course-player").isLoading()})));return(0,R.useEffect)((()=>{y&&(l(y.rating||5),d(y.content||""))}),[y]),console.log("isOpen",e),e?(0,L.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:r,children:(0,L.jsxs)("div",{className:"bg-white rounded-lg max-w-lg w-full p-6 shadow-xl",onClick:e=>e.stopPropagation(),children:[(0,L.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,L.jsxs)("div",{children:[(0,L.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Share Your Experience"}),(0,L.jsx)("p",{className:"text-gray-600 mt-2",children:o})]}),(0,L.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:(0,L.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),x?.avatar&&(0,L.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,L.jsx)("img",{src:x.avatar,alt:x.name||"User avatar",className:"w-10 h-10 rounded-full"}),(0,L.jsx)("span",{className:"font-medium text-gray-700",children:x.name||"Anonymous"})]}),g?(0,L.jsx)(H,{}):(0,L.jsx)(z,{rating:a,review:c,error:u,onRatingChange:l,onReviewChange:d,onSubmit:async()=>{if(c.length<10)m("Please write a more detailed review (minimum 10 characters)");else try{await p("custom-course-player").submitCourseReview({rating:a,review:c,courseId:t||0}),h(!0),setTimeout((()=>{r(),i?.()}),2e3)}catch(e){m("Failed to submit review. Please try again later.")}},isLoading:v})]})}):null}const G=({progress:e,size:t=42,strokeWidth:r=3,circleColor:s="text-gray-700",progressColor:o="text-green-500"})=>{console.log({progress:e});const n=t/2,i=n-r,a=2*Math.PI*i,l=`${e/100*a}, ${a}`;return(0,L.jsx)("div",{className:"flex items-center gap-2",children:(0,L.jsxs)("div",{className:"relative",children:[(0,L.jsxs)("svg",{className:"transform -rotate-90",width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[(0,L.jsx)("circle",{cx:n,cy:n,r:i,stroke:"currentColor",strokeWidth:r,fill:"none",className:s}),(0,L.jsx)("circle",{cx:n,cy:n,r:i,stroke:"currentColor",strokeWidth:r,fill:"none",className:o,strokeDasharray:l,strokeLinecap:"round"})]}),(0,L.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium",children:[e,"%"]})]})})},Y=({isOpen:e,onToggle:t,completedUnits:r,totalUnits:s})=>(0,L.jsxs)("div",{className:"relative",children:[(0,L.jsxs)("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 hover:bg-gray-700 rounded-md transition-colors",children:[(0,L.jsx)("span",{children:"Progress"}),(0,L.jsx)("svg",{className:"w-4 h-4 transition-transform "+(e?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e&&(0,L.jsx)("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg z-50",children:(0,L.jsx)("div",{className:"p-4",children:(0,L.jsxs)("div",{className:"space-y-4",children:[(0,L.jsxs)("div",{children:[(0,L.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Course Progress"}),(0,L.jsxs)("p",{className:"text-sm text-gray-600",children:[r," of ",s," units completed"]})]}),(0,L.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,L.jsx)("div",{className:"bg-green-500 h-2.5 rounded-full transition-all duration-300",style:{width:r/s*100+"%"}})})]})})})]});function K({onToggleSidebar:e}){var t,r;const[s,i]=(0,R.useState)(!1),{courseInfo:a,totalUnits:l,completedUnits:c,review:d,reviewLoading:u,progress:m,reviewModalOpen:g}=(0,n.useSelect)((e=>({courseInfo:e("custom-course-player").getCourseInfo(),totalUnits:e("custom-course-player").getAllUnits(),completedUnits:e("custom-course-player").getCompletedUnits(),review:e("custom-course-player").getCourseReview(),reviewLoading:e("custom-course-player").getReviewLoading(),reviewError:e("custom-course-player").getReviewError(),reviewModalOpen:e("custom-course-player").getReviewModalOpen(),progress:e("custom-course-player").getProgress()})),[]),h=(0,n.useDispatch)(),p=e=>{h("custom-course-player").setReviewModalOpen(e)};(0,R.useEffect)((()=>{a?.course_id&&(console.log("Fetching review",a.course_id),h("custom-course-player").fetchCourseReview(a.course_id))}),[a?.course_id]);const x=(0,o.useMemo)((()=>void 0!==d?.comment_ID),[d]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"fixed top-0 left-0 right-0 bg-gray-800 text-white z-50",children:[(0,L.jsxs)("div",{className:"h-16 px-4 flex items-center justify-between",children:[(0,L.jsx)("div",{className:"flex items-center gap-4",children:(0,L.jsx)("h1",{className:"text-xl font-bold truncate max-w-md text-secondary-50",children:a?.course_title||""})}),(0,L.jsxs)("div",{className:"flex items-center gap-4",children:[(0,L.jsx)(G,{progress:m}),!x&&(0,L.jsx)("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700  transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500  focus:ring-offset-2 focus:ring-offset-gray-800",disabled:u||!1,children:u?"Loading...":"Leave a Review"}),(0,L.jsx)(Y,{isOpen:s,onToggle:()=>i(!s),completedUnits:null!==(t=c?.length)&&void 0!==t?t:0,totalUnits:null!==(r=l?.length)&&void 0!==r?r:0}),(0,L.jsx)("button",{onClick:e,className:"p-2 hover:bg-gray-700 rounded-md transition-colors","aria-label":"Toggle sidebar",children:(0,L.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),(0,L.jsx)("div",{className:"h-1 bg-gray-700",children:(0,L.jsx)("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${m}%`}})})]}),g&&(0,L.jsx)(V,{isOpen:Boolean(!u&&g),onClose:()=>p(!1),courseId:a?.course_id,courseName:a?.course_title,progress:m,onReviewSuccess:()=>{}}),s&&(0,L.jsx)("div",{className:"fixed inset-0 z-20",onClick:()=>i(!1)})]})}const X=({courseId:e})=>{const[t,r]=(0,R.useState)(!0),{fetchCourseData:s,nextUnit:o,prevUnit:i}=(0,n.useDispatch)("custom-course-player"),{courseInfo:a,loading:l,error:c,currentUnitId:d}=(0,n.useSelect)((e=>({courseInfo:e("custom-course-player")?.getCourseInfo()||null,loading:e("custom-course-player")?.isLoadingUserInfo()||!1,error:e("custom-course-player")?.getError()||null,currentUnitId:e("custom-course-player")?.getCurrentUnitId()||null})),[]);(0,R.useEffect)((()=>{e&&s(e)}),[e]);const u=()=>{r(!t)};return l?(0,L.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,L.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):c?(0,L.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,L.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg",children:[(0,L.jsx)("p",{className:"text-red-600",children:c}),(0,L.jsx)("button",{onClick:()=>e&&s(e),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"})]})}):(0,L.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,L.jsx)(K,{onToggleSidebar:u,isSidebarOpen:t}),(0,L.jsxs)("div",{className:"flex flex-1 overflow-hidden pt-16",children:[(0,L.jsx)(_,{courseId:e,currentUnitId:d,isSidebarOpen:t,onToggleSidebar:u,onPrevious:()=>{i()},onNext:()=>{o()}}),a&&(0,L.jsx)(W,{isOpen:t,onToggle:u})]})]})};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("wplms-custom-course-player");if(e){const t=e.getAttribute("data-course-id")||"0";(0,s.H)(e).render((0,L.jsx)(X,{courseId:t}))}}))})();